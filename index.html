<html>

<head>

	<meta charset="utf-8">
	<title>My first three.js app</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			width: 100%;
			height: 100%;
		}

		ports {
			width: 4096px;
			height: 2048px;
		}
	</style>
</head>

<body>

	<script src="assets/js/three.js"></script>
	<script src="assets/js/OrbitControls.js"></script>
	<script src="assets/js/CSVToArray.js"></script>

	<script>
		// constants
		const earthRadius = 5;
		const cloudRadius = earthRadius * 1.01;

		// initialising renderer
		var renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		// initialising scene + camera with controls
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
		var controls = new THREE.OrbitControls(camera, renderer.domElement);

		// initialising light
		var ambLight = new THREE.AmbientLight(0x333333);
		var dirLight = new THREE.DirectionalLight(0xffffff, 1);
		dirLight.position.set(20, 30, 20);

		camera.position.z = 10;
		controls.update();

		// initialising texture and bind it to a material
		var texEarth = new THREE.TextureLoader().load('./assets/textures/earthmap4k.jpg');
		var bumpEarth = new THREE.TextureLoader().load('./assets/textures/earth_normalmap_flat4k.jpg');
		var specEarth = new THREE.TextureLoader().load('./assets/textures/earthspec4k.jpg');
		var matEarth = new THREE.MeshPhongMaterial({
			map: texEarth,
			normalMap: bumpEarth,
			specularMap: specEarth,
			specular: new THREE.Color('grey')
		})
		var texClouds = new THREE.TextureLoader().load('./assets/textures/fair_clouds_4k.png');
		var matClouds = new THREE.MeshBasicMaterial({ map: texClouds });
		matClouds.transparent = true;

		// ports canvas texture
		var portsCanvas = document.createElement("canvas");
		var texPortsTexture = portsCanvas.getContext('2d');
		texPortsTexture.canvas.width = 4096;
		texPortsTexture.canvas.height = 2048;

		// create Mesh
		var geoEarth = new THREE.SphereGeometry(earthRadius, 32, 32);
		var geoClouds = new THREE.SphereGeometry(cloudRadius, 32, 32);

		var earth = new THREE.Mesh(geoEarth, matEarth);
		var clouds = new THREE.Mesh(geoClouds, matClouds);

		// bind clouds to earth
		earth.add(clouds);

		// add Lights and earthObject to scene
		scene.add(earth, ambLight, dirLight);


		// earth rotation + cloud rotation
		var animate = function () {
			requestAnimationFrame(animate);

			earth.rotation.y -= 0.005;
			clouds.rotation.y -= 0.002;

			renderer.render(scene, camera);
		};


		function addPorts() {
			// 2d canvas context: texPortsTexture 

			var request = new XMLHttpRequest();
			request.open('GET', './assets/data/wpi.csv');

			request.onload = function () {
				data = CSVToArray(this.response, ";");
				console.log(data);

				// modify texPortsTexture here!!!

			};

			request.onerror = function () {
				console.log("Cannot load csv!");
			};

			request.send();
		}

		addPorts();
		animate();
	</script>

</body>

</html>